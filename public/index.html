<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LLM Chat App</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h1>Cloudflare AI 채팅</h1>
        <div id="auth-container">
          <button id="login-btn" class="btn-small">로그인</button>
          <button id="signup-btn" class="btn-small">회원가입</button>
          <span id="user-info" style="display:none; font-size:0.9rem;"></span>
          <button id="logout-btn" class="btn-small" style="display:none;">로그아웃</button>
        </div>
      </div>
      <p>Cloudflare Workers AI로 구동됩니다</p>
      <div style="margin-top:8px; display:flex; gap:8px; align-items:center; justify-content:center;">
        <div style="flex: 1;"> 
          <strong style="display:block;">안내: 한국어 전용 챗봇</strong>
          <small style="color:var(--text-light);">입력은 한국어로 해 주십시오. 운세는 생년월일을 기준으로 간단하게 안내합니다.</small>
        </div>
        <details id="system-instructions" style="margin-left:12px;">
          <summary style="cursor:pointer; font-weight:500; color:var(--primary-color);">사용 방법</summary>
          <div style="margin-top:6px; font-size:0.95rem; color:var(--text-light);">
            <ul style="margin-top:6px; list-style:disc; margin-left:18px;">
              <li>생년월일을 설정한 다음, <code>오늘 운세 알려줘</code> 라고 입력하세요.</li>
              <li>운세를 요청하려면 '운세 요청'을 체크하고 원하는 '운세 타입'을 선택하세요.</li>
              <li>예: <code>[생년월일] 1990-01-01</code> → <code>오늘 운세 알려줘</code></li>
            </ul>
          </div>
        </details>
      </div>
    </header>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
      <div class="modal-content" style="background:white; padding:20px; border-radius:8px; width:300px; max-width:90%;">
        <h2 id="auth-title" style="margin-top:0;">로그인</h2>
        <form id="auth-form" style="display:flex; flex-direction:column; gap:10px;">
          <input type="text" id="auth-username" placeholder="아이디" required style="padding:8px; border:1px solid #ddd; border-radius:4px;">
          <div style="position:relative;">
            <input type="password" id="auth-password" placeholder="비밀번호" required style="padding:8px; border:1px solid #ddd; border-radius:4px; width:100%; box-sizing:border-box;">
            <button type="button" id="toggle-password" style="position:absolute; right:8px; top:50%; transform:translateY(-50%); background:none; border:none; cursor:pointer; font-size:1.2rem;" title="비밀번호 보기">👁️</button>
          </div>
          <input type="text" id="auth-birthdate" placeholder="생년월일 (YYYYMMDD, 선택)" style="padding:8px; border:1px solid #ddd; border-radius:4px; display:none;">
          <button type="submit" class="btn-primary" style="padding:8px;">확인</button>
          <button type="button" id="auth-cancel" class="btn-muted" style="padding:8px;">취소</button>
        </form>
        <p id="auth-message" style="color:red; font-size:0.8rem; margin-top:10px;"></p>
      </div>
    </div>

    <div class="chat-container">
      <div id="chat-messages" class="chat-messages">
        <div class="message assistant-message">
          <p>
            안녕하세요! 저는 생년월일을 기반으로 운세를 알려드리는 한국어 전용 도우미입니다. 생년월일을 입력하거나 UI에서 설정하시면 띠 기반의 오늘의 운세 및 간단한 추천 행동을 한국어로 안내해 드립니다.
          </p>
        </div>
      </div>

      <div class="typing-indicator" id="typing-indicator">
        AI is thinking...
      </div>

      <!-- Compact controls bar (desktop & mobile) -->
      <div class="controls-bar">
        <div class="controls-left">
            <label for="birthdate-input">생년월일</label>
            <button id="birthdate-dec" aria-label="하루 감소" title="하루 감소">−</button>
            <input id="birthdate-input" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="YYYYMMDD" maxlength="8" />
            <button id="birthdate-inc" aria-label="하루 증가" title="하루 증가">＋</button>
          </div>
        <div class="controls-middle">
          <label for="target-date-input">운세 날짜</label>
          <button id="target-date-dec" aria-label="하루 감소" title="하루 감소">−</button>
          <input id="target-date-input" type="date" />
          <button id="target-date-inc" aria-label="하루 증가" title="하루 증가">＋</button>
          <button id="target-date-today" class="btn-small" title="오늘로 설정" style="margin-left:4px; padding:2px 6px; font-size:0.8rem;">오늘</button>
        </div>
        <div class="controls-right">
          <button id="set-birthdate-button" class="btn-primary">설정</button>
          <button id="clear-birthdate-button" class="btn-muted">지우기</button>
          <button id="controls-toggle" class="btn-icon" aria-label="옵션">⚙️</button>
        </div>
      </div>

      <div class="message-input" role="region" aria-label="채팅 입력 영역">
        <div style="display:flex; flex-direction:column; gap:8px; width:100%;">
          <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
            <label for="birthdate-input" style="font-size:0.85rem; color:var(--text-light);">생년월일:</label>
            <!-- Fallback area: selects and display (keeps selects for old devices) -->
            <!-- Fallback selects for older mobile browsers -->
            <div id="birthdate-selects" style="display:none; gap:6px; align-items:center;">
              <select id="birthdate-year" style="padding:0.3rem; border:1px solid var(--border-color); border-radius:4px;">
                <option value="">년</option>
              </select>
              <select id="birthdate-month" style="padding:0.3rem; border:1px solid var(--border-color); border-radius:4px;">
                <option value="">월</option>
              </select>
              <select id="birthdate-day" style="padding:0.3rem; border:1px solid var(--border-color); border-radius:4px;">
                <option value="">일</option>
              </select>
            </div>
            <!-- Target date (운세 날짜) -->
            <label for="target-date-input" style="font-size:0.85rem; color:var(--text-light); margin-left:8px;">운세 날짜:</label>
            <div id="target-date-display" style="font-size:0.9rem; color:var(--text-light); margin-left:6px;">(운세 날짜: 오늘)</div>
            <!-- Buttons are in main controls bar. Keep small display area for currently selected date -->
<!-- '오늘로 설정' 버튼은 제거되었습니다 -->
            <div id="birthdate-display" style="margin-left:auto; font-size:0.9rem; color:var(--text-light);"></div>
          </div>

          <!-- Horoscope options -->
          <div id="controls-panel" class="controls-panel" style="display:none;">
            <label class="control-inline"><input id="horoscope-checkbox" type="checkbox" /> 운세 요청</label>
            <label class="control-inline">운세 타입: 
              <select id="horoscope-type">
                <option value="mixed">혼합</option>
                <option value="chinese">한국/중국 띠</option>
              </select>
            </label>
            <div style="margin-left:auto; font-size:0.85rem; color:var(--text-light);">운세 요청 시 <strong>생년월일</strong>이 필요합니다.</div>
          </div>

          <div style="display:flex; gap:8px; align-items:center;">
            <textarea
              id="user-input"
              placeholder="메시지를 입력하세요... (한국어로 입력해주세요)"
              rows="1"
              autofocus
              style="flex:1"
            ></textarea>
            <button id="send-button">전송</button>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <p>Cloudflare Workers AI Chat Template &copy; 2025</p>
    </footer>

    <!-- Chat app script -->
    <script src="chat.js"></script>
    <!-- Mobile-only toolbar -->
    <div id="mobile-toolbar" class="mobile-toolbar" aria-hidden="true">
      <button id="toolbar-dob" class="mobile-toolbar-btn" aria-label="생년월일 설정">생년월일</button>
      <button id="toolbar-horoscope" class="mobile-toolbar-btn" aria-label="운세 요청">운세</button>
      <button id="toolbar-focus" class="mobile-toolbar-btn" aria-label="메시지 입력으로 포커스">입력</button>
    </div>
  </body>
</html>
