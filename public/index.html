<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="theme-color" content="#f6821f" />
    <title>오늘의 운세 - AI 챗봇</title>
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <header>
      <div class="header-top">
        <h1>Cloudflare AI 채팅</h1>
        <div id="auth-container">
          <button id="login-btn" class="btn-small">로그인</button>
          <button id="signup-btn" class="btn-small">회원가입</button>
          <span id="user-info"></span>
          <button id="logout-btn" class="btn-small">로그아웃</button>
        </div>
      </div>
      <p>Cloudflare Workers AI로 구동됩니다</p>
      <div class="header-info">
        <div class="header-info-main"> 
          <strong>안내: 한국어 전용 챗봇</strong>
          <small>입력은 한국어로 해 주십시오. 운세는 생년월일을 기준으로 간단하게 안내합니다.</small>
        </div>
        <details id="system-instructions">
          <summary>사용 방법</summary>
          <div>
            <ul>
              <li>생년월일을 설정한 다음, <code>오늘 운세 알려줘</code> 라고 입력하세요.</li>
              <li>운세를 요청하려면 '운세 요청'을 체크하고 원하는 '운세 타입'을 선택하세요.</li>
              <li>예: <code>[생년월일] 1990-01-01</code> → <code>오늘 운세 알려줘</code></li>
            </ul>
          </div>
        </details>
      </div>
    </header>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal" style="display:none;">
      <div class="modal-content">
        <h2 id="auth-title">로그인</h2>
        <form id="auth-form">
          <input type="text" id="auth-username" placeholder="아이디" required>
          <input type="password" id="auth-password" placeholder="비밀번호" required>
          <label>
            <input type="checkbox" id="toggle-password-check"> 비밀번호 표시
          </label>
          <input type="text" id="auth-birthdate" placeholder="생년월일 (YYYYMMDD, 선택)" style="display:none;">
          <button type="submit" class="btn-primary">확인</button>
          <button type="button" id="auth-cancel" class="btn-muted">취소</button>
        </form>
        <p id="auth-message"></p>
      </div>
    </div>

    <div class="chat-container">
      <div id="chat-messages" class="chat-messages">
        <div class="message assistant-message">
          <p>
            안녕하세요! 저는 생년월일을 기반으로 운세를 알려드리는 한국어 전용 도우미입니다. 생년월일을 입력하거나 UI에서 설정하시면 띠 기반의 오늘의 운세 및 간단한 추천 행동을 한국어로 안내해 드립니다.
          </p>
        </div>
      </div>

      <div class="typing-indicator" id="typing-indicator">
        AI is thinking...
      </div>

      <!-- Compact controls bar (desktop & mobile) -->
      <div class="controls-bar">
        <div class="controls-left">
            <label for="birthdate-input">생년월일</label>
            <button id="birthdate-dec" aria-label="하루 감소" title="하루 감소">−</button>
            <input id="birthdate-input" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="YYYYMMDD" maxlength="8" />
            <button id="birthdate-inc" aria-label="하루 증가" title="하루 증가">＋</button>
          </div>
        <div class="controls-middle">
          <label for="target-date-input">운세 날짜</label>
          <button id="target-date-dec" aria-label="하루 감소" title="하루 감소">−</button>
          <input id="target-date-input" type="date" />
          <button id="target-date-inc" aria-label="하루 증가" title="하루 증가">＋</button>
          <button id="target-date-today" class="btn-small" title="오늘로 설정" style="margin-left:4px; padding:2px 6px; font-size:0.8rem;">오늘</button>
        </div>
        <div class="controls-right">
          <button id="set-birthdate-button" class="btn-primary">설정</button>
          <button id="clear-birthdate-button" class="btn-muted">지우기</button>
          <button id="controls-toggle" class="btn-icon" aria-label="옵션">⚙️</button>
        </div>
      </div>

      <div class="message-input" role="region" aria-label="채팅 입력 영역">
        <div class="input-container">
          <div class="input-row">
            <label for="birthdate-input">생년월일:</label>
            <div id="birthdate-selects">
              <select id="birthdate-year">
                <option value="">년</option>
              </select>
              <select id="birthdate-month">
                <option value="">월</option>
              </select>
              <select id="birthdate-day">
                <option value="">일</option>
              </select>
            </div>
            <label for="target-date-input" class="target-date-label">운세 날짜:</label>
            <div id="target-date-display">(운세 날짜: 오늘)</div>
            <div id="birthdate-display"></div>
          </div>

          <!-- Horoscope options -->
          <div id="controls-panel" class="controls-panel" style="display:none;">
            <label class="control-inline controls-panel-label">
              <input id="horoscope-checkbox" type="checkbox" /> 운세 요청
            </label>
            <label class="control-inline">운세 타입: 
              <select id="horoscope-type">
                <option value="mixed">혼합</option>
                <option value="chinese">한국/중국 띠</option>
              </select>
            </label>
            <div class="controls-panel-info">운세 요청 시 <strong>생년월일</strong>이 필요합니다.</div>
          </div>

          <div class="textarea-row">
            <div id="zodiac-display" class="zodiac-info" style="display:none;">
              <span id="zodiac-sign"></span>
              <span id="zodiac-dates" class="zodiac-dates-small"></span>
            </div>
            <textarea
              id="user-input"
              placeholder="메시지를 입력하세요... (한국어로 입력해주세요)"
              rows="1"
              autofocus
            ></textarea>
            <button id="send-button">전송</button>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <p>Cloudflare Workers AI Chat Template &copy; 2025</p>
    </footer>

    <!-- Mobile-only toolbar -->
    <div id="mobile-toolbar" class="mobile-toolbar" aria-hidden="true">
      <button id="toolbar-dob" class="mobile-toolbar-btn" aria-label="생년월일 설정">생년월일</button>
      <button id="toolbar-horoscope" class="mobile-toolbar-btn" aria-label="운세 요청">운세</button>
      <button id="toolbar-focus" class="mobile-toolbar-btn" aria-label="메시지 입력으로 포커스">입력</button>
    </div>

    <script src="js/app.js"></script>
  </body>
</html>
